# –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –∫–æ–¥-—Ä–µ–≤—å—é

–Ø –ø—Ä–æ–≤–µ–ª –∞–Ω–∞–ª–∏–∑ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≤—ã—è–≤–∏–ª —Å–ª–µ–¥—É—é—â–∏–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è.

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã)
1.  **–£—Ç–µ—á–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω –≤ SMTP**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
2.  **–ó–∞–≤–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ (Dial)**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–∞–π–º–∞—É—Ç–æ–≤.
3.  **–î–≤–æ–π–Ω–æ–π —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç –∫ –ë–î**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —É–ø—Ä–æ—â–µ–Ω–∏–µ–º –ª–æ–≥–∏–∫–∏ –≤ `service.go`.

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–æ—Ç–∞—Ü–∏—è (logger/logger.go)
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `lumberjack.v2` –¥–ª—è —Ä–æ—Ç–∞—Ü–∏–∏, –Ω–æ –∫–æ–Ω—Ñ–∏–≥ `MaxAge` (10 –¥–Ω–µ–π) –∏ `MaxArchiveFiles` (10 —Ñ–∞–π–ª–æ–≤) –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å. –ï—Å–ª–∏ –ª–æ–≥–æ–≤ –º–Ω–æ–≥–æ, —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è—Ç—Å—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É, –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É–≤ –≤–æ–∑—Ä–∞—Å—Ç–∞.
*   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –£–≤–µ–ª–∏—á–∏—Ç—å `MaxArchiveFiles` –∏–ª–∏ –ø–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ `MaxAge`.

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π (email/attachments.go)
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥ `processFile` —á–∏—Ç–∞–µ—Ç –≤–µ—Å—å —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç—å (`io.ReadAll`).
*   **–†–∏—Å–∫**: –ï—Å–ª–∏ —Ñ–∞–π–ª –æ–≥—Ä–æ–º–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 500 –ú–ë), —ç—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å OOM (Out Of Memory).
*   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≤–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 25 –ú–ë) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É (—Ö–æ—Ç—è –¥–ª—è SMTP –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–∏–¥–µ—Ç—Å—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–ª–æ –ø–∏—Å—å–º–∞).

### 3. Crystal Reports (email/crystal_reports.go)
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `http.Client` —Å —Ç–∞–π–º–∞—É—Ç–æ–º 60 —Å–µ–∫—É–Ω–¥.
*   **–†–∏—Å–∫**: –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ —ç—Ç–æ–≥–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞–ª–æ.
*   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í—ã–Ω–µ—Å—Ç–∏ —Ç–∞–π–º–∞—É—Ç –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`settings.ini`).

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (settings/settings.go)
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ `settings.ini`.
*   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —á—Ç–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (ENV).

### 5. Main (main.go)
*   **–ü—Ä–æ–±–ª–µ–º–∞**: `initializeDatabase` –≤—ã–∑—ã–≤–∞–µ—Ç `log.Fatal` –ø—Ä–∏ –æ—à–∏–±–∫–µ. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞, –Ω–æ –Ω–µ –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ graceful shutdown, –µ—Å–ª–∏ –ë–î –ª–µ–∂–∏—Ç –Ω–∞ —Å—Ç–∞—Ä—Ç–µ (—Å–µ—Ä–≤–∏—Å –ø—Ä–æ—Å—Ç–æ –ø–∞–¥–∞–µ—Ç –≤ —Ü–∏–∫–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ Docker).
*   **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å retry-–ª–æ–≥–∏–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, —á—Ç–æ–±—ã —Å–µ—Ä–≤–∏—Å –º–æ–≥ –∂–¥–∞—Ç—å –ø–æ–¥–Ω—è—Ç–∏—è –ë–î.

## üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é (Refactoring)

### 1. –í—ã–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
–°–µ–π—á–∞—Å `Service` –∂–µ—Å—Ç–∫–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `DBConnection` –∏ `QueueReader`.
**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ**: –í—ã–¥–µ–ª–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `Database` –∏ `MessageSource`. –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–º–æ–∂–Ω–æ –±—É–¥–µ—Ç –º–æ–∫–∞—Ç—å –ë–î).

### 2. –£–ø—Ä–æ—â–µ–Ω–∏–µ `service.go`
–ú–µ—Ç–æ–¥ `Run` –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π –∏ —Å–ª–æ–∂–Ω—ã–π (—Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É —á—Ç–µ–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∏, –æ—Ç–ø—Ä–∞–≤–∫–∏, —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞).
**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ**: –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–µ–ª–∫–∏–µ –º–µ—Ç–æ–¥—ã: `processMessage`, `handleConnectionError`, `sendEmail`.

### 3. –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –≤ –ë–î
–í `db/oracle.go` –º–Ω–æ–≥–∏–µ –º–µ—Ç–æ–¥—ã —Å–æ–∑–¥–∞—é—Ç —Å–≤–æ–π `context.WithTimeout`.
**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ**: –ü—Ä–∏–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–Ω–∞—Ä—É–∂–∏ (–æ—Ç –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ), —á—Ç–æ–±—ã —Ç–∞–π–º–∞—É—Ç–æ–º —É–ø—Ä–∞–≤–ª—è–ª –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å, –∞ –Ω–µ –¥—Ä–∞–π–≤–µ—Ä –ë–î.

## –ò—Ç–æ–≥
–ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –¥–æ–±—Ä–æ—Ç–Ω–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–Ω—è—Ç–Ω–∞—è. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º—ã —É—Å—Ç—Ä–∞–Ω–∏–ª–∏. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∫–∞—Å–∞—é—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

**–†–µ–∫–æ–º–µ–Ω–¥—É—é –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å:**
1.  –î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä –≤–ª–æ–∂–µ–Ω–∏–π.
2.  –í—ã–Ω–µ—Å—Ç–∏ —Ç–∞–π–º–∞—É—Ç Crystal Reports –≤ –∫–æ–Ω—Ñ–∏–≥.
