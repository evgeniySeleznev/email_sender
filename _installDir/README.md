# Инструкция по установке и тестированию Email Sender

## Структура установочного пакета

В папке `_installDir` содержатся файлы, необходимые для установки приложения:

- `compose.yaml` - файл для запуска контейнера из Harbor
- `settings/settings.ini.example` - пример файла настроек

## Подготовка к установке

1. **Скопируйте пример файла настроек:**
   ```
   cp settings/settings.ini.example settings/settings.ini
   ```

2. **Отредактируйте файл настроек `settings/settings.ini`:**
   - Укажите учетные данные для подключения к Oracle БД в секции `[main]`
   - Настройте параметры очереди в секции `[queue]`
   - Укажите параметры SMTP серверов в секциях `[SMTP]` и `[SMTP1]`
   - Настройте расписание работы в секции `[Schedule]`
   - Настройте режим работы и логирование в секциях `[Mode]` и `[Log]`
   - Укажите параметры доступа к CIFS/SMB шарам в секции `[share]` (для вложений типа 3, если необходимо)

3. **Создайте папку для логов и установите права доступа:**
   ```
   mkdir -p logs
   chmod 777 logs
   ```

## Установка и запуск

1. **Запустите контейнер с помощью docker compose:**
   ```
   docker compose up -d
   ```

2. **Проверьте статус контейнера:**
   ```
   docker compose ps
   ```

## Остановка и удаление

```
# Остановка контейнера
docker compose stop

# Удаление контейнера
docker compose down
```

## Обновление версии

Для обновления на новую версию:

**Перезапишите файл `compose.yaml`**

## Устранение неполадок

### Контейнер не запускается

1. Проверьте логи приложения:
   ```
   tail -100 logs/app.log
   ```

2. Проверьте, что файл настроек существует и доступен:
   ```
   ls -la settings/settings.ini
   ```

3. Проверьте права доступа к файлу:
   ```
   chmod 644 settings/settings.ini
   ```

### Ошибки подключения к Oracle

1. Проверьте настройки подключения в `settings/settings.ini`
2. Убедитесь, что Oracle сервер доступен из сети, где запущен контейнер
3. Проверьте, что Oracle Instant Client установлен в образе (должен быть в образе из Harbor)

### Ошибки SMTP подключения

1. Проверьте настройки SMTP серверов в `settings/settings.ini`
2. Убедитесь, что SMTP сервер доступен из сети контейнера
3. Проверьте правильность учетных данных

### Сообщения не обрабатываются

1. Проверьте, что очередь не пуста в Oracle БД
2. Проверьте логи в файле `logs/app.log` на наличие ошибок обработки: `grep -i "ошибка\|error" logs/app.log`
3. Убедитесь, что consumer name правильный и имеет доступ к очереди
